<p-toast></p-toast>
<app-breadcrumb></app-breadcrumb>
<!--
<div class="grid">
	<div class="col-12">
		<div class="card">
            <app-dynamic-table [dataTable]="dataTable" 
                               [headersTable]="headersTable"
                               dataKey="id" 
                               [rows]="10" 
                               [paginator]="true"
                               [selectionMode]="'multiple'"
                               [showBtnNew]="showBtnNew"
                               [showBtnEdit]="showBtnEdit"
                               [showBtnExp]="showBtnExp"
                               [showBtnDelete]="showBtnDelete"
                               nameExport="solicitude_de_cargue"
                               (onEditAccion)="editSolicitud($event)"
                               (onDeleteAccion)="deleteSoliciturd($event)"
                               (onNewAccion)="nuevaSolicitud($event)">
            </app-dynamic-table>
        </div>
    </div>
</div>
-->

<div class="grid">
	<div class="col-12">
		<div class="card" style=" background-image: url('https://nitrofert.com.co/wp-content/uploads/2023/05/Recurso_17@2x.png'); background-size:cover;">
            <div class="field col-12 ">
                <span class="p-float-label">
                    <p-calendar id="rangoFecha" [(ngModel)]="filtroRnagoFechas" selectionMode="range" [readonlyInput]="true" [showIcon]="true" [numberOfMonths]="1"  styleClass="w-full"  (ngModelChange)="cambioFecha($event)"  ></p-calendar>
                    <label for="rangoFecha"><h6>Seleccionar rango de fecha</h6></label>
                </span>
            </div>
            
        </div>
    </div>
</div>

<div class="grid flex align-items-center flex-wrap">
    <div class="col-12 xl:col-8">
        <div class="card" style=" background-image: url('https://nitrofert.com.co/wp-content/uploads/2023/05/Recurso_17@2x.png'); background-size:cover;">
            <h5>Toneladas por estados</h5>
            <p-chart type="bar" [data]="barStackChart" [options]="optionsBarStackChart"></p-chart>
        </div>
    </div>
    <div class="col-12 xl:col-4">
        <div class="card" style=" background-image: url('https://nitrofert.com.co/wp-content/uploads/2023/05/Recurso_17@2x.png'); background-size:cover;">
            <h5>% Carga por estados</h5>
            <p-chart type="pie" [data]="pieChart" [options]="optionsPieChart"></p-chart>
        </div>
    </div>
</div>



<div class="grid">
	<div class="col-12">
		<div class="card">
            <p-table #dt1 
					 [value]="solicitudesExtendida" 
					 [dataKey]="dataKey" 
					 [rows]="10" 
					 [rowsPerPageOptions]="[10, 50, 100]"
					 [loading]="loading" 
					 [rowHover]="true" 
					 [styleClass]="'p-datatable-gridlines p-datatable-sm border-1 '" 
					 [paginator]="true"
					 [globalFilterFields]="globalFilterFields" 
					 [selectionMode]="selectionMode" 
					 [(selection)]="selectedItem" 
					 responsiveLayout="scroll">
				<ng-template pTemplate="caption">
					<div class="flex justify-content-between flex-column sm:flex-row">
						<div>
							
							<button pButton 
									pTooltip="Limpiar" tooltipPosition="bottom" placeholder="Bottom"  
									class="p-button-outlined mb-2 mr-2 p-button-sm" 
									icon="pi pi-filter-slash"
									(click)="clear(dt1)">
							</button>

                            <button pButton
									*ngIf="showBtnNew" 
									[pTooltip]="'Nueva solicitud'" tooltipPosition="bottom" placeholder="Bottom"  
									class="p-button-outlined mb-2 mr-2 p-button-success p-button-sm" 
									icon="pi pi-plus"
									
									(click)="nuevaSolicitud($event)">
							</button>

														
							<button pButton
									*ngIf="showBtnExp" 
							        pTooltip="Exportar a excel" tooltipPosition="bottom" placeholder="Bottom"   
							        class="p-button-outlined mb-2 mr-2 p-button-success p-button-sm" 
							        icon="pi pi-file-excel" 
							        (click)="exportExcel()">
							</button>

							
						
						</div>
						<div>
							<span class="p-input-icon-left mb-2">
								<i class="pi pi-search"></i>
								<input pInputText type="text" #filter (input)="onGlobalFilter(dt1, $event)" placeholder="Buscar por palabra clave" class="w-min p-inputtext-sm"/>
							</span>
						</div>
						

					</div>
				</ng-template>
				<ng-template pTemplate="header">
					<tr>
						<th style="width: 3rem">
                            <!--<p-tableHeaderCheckbox></p-tableHeaderCheckbox>-->
                        </th>

                        <th pSortableColumn="detalle_solicitudes_turnos_estado" style="min-width:11rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Estado turno</div>
                                <div>
                                    <!--<p-columnFilter field="detalle_solicitudes_turnos_estado" 
                                                matchMode="in" 
                                                display="menu" 
                                                [showMatchModes]="false" 
                                                [showOperator]="false" 
                                                [showAddButton]="false">

                                    <ng-template pTemplate="header">
                                        <div class="px-3 pt-3 pb-0">
                                            <span class="font-bold">Seleccionar estado</span>
                                        </div>
                                    </ng-template>
                                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                        <p-multiSelect [ngModel]="value" [options]="estadosTurno" placeholder="Cualquiera" (onChange)="filter($event.value)" >
                                            
                                            <ng-template let-option pTemplate="item">
                                                <div class="inline-block vertical-align-middle">
                                                    
                                                    <span class="ml-1 mt-1">{{ option.name }}</span>
                                                </div>
                                            </ng-template>
                                        </p-multiSelect>
                                    </ng-template>
                                </p-columnFilter>-->
                                    <p-sortIcon field="detalle_solicitudes_turnos_estado"></p-sortIcon>
                                    <p-columnFilter field="detalle_solicitudes_turnos_estado" 
                                                    matchMode="equals" 
                                                    display="menu" 
                                                    placeholder="Buscar por estado"
                                                    [showMatchModes]="false" 
                                                    [showOperator]="false"
                                                    [showAddButton]="false"
                                                    [showApplyButton]="false">

                                                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                                        <p-dropdown [ngModel]="value" [options]="estadosTurno" (onChange)="filter($event.value)" placeholder="Cualquiera" >
                                                            <ng-template pTemplate="selectedItem">
                                                                <div>{{ value }}</div>
                                                            </ng-template>
                                                            <ng-template let-option pTemplate="item">
                                                                <span [class]="'customer-badge status-' + option.name">{{option.name}}</span>
                                                            </ng-template>
                                                        </p-dropdown>
                                                    </ng-template>

                                    </p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="locacion_label" style="min-width:15rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Locación cita/turno</div>
                                <div>
                                    <p-sortIcon field="locacion_label"></p-sortIcon>
                                    <!--<p-columnFilter type="text" field="locacion_label" display="menu" placeholder="Buscar por locación turno"></p-columnFilter>-->
                                    <p-columnFilter field="filtroLocacion" matchMode="in" display="menu" [showMatchModes]="false" [showOperator]="false" [showAddButton]="false">
                                        <ng-template pTemplate="header">
                                            <div class="px-3 pt-3 pb-0">
                                                <span class="font-bold">Seleccione una locación</span>
                                            </div>
                                        </ng-template>
                                        <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                            <p-multiSelect [ngModel]="value" [options]="filtroLocaciones" placeholder="Cualquiera" (onChange)="filter($event.value)" optionLabel="name">
                                                <ng-template let-option pTemplate="item">
                                                    <div class="inline-block vertical-align-middle">
                                                        <!--<img [alt]="option.label" src="https://primefaces.org/cdn/primeng/images/demo/avatar/{{ option.image }}" width="24" class="vertical-align-middle" />-->
                                                        <span class="ml-1 mt-1">{{ option.name }}</span>
                                                    </div>
                                                </ng-template>
                                            </p-multiSelect>
                                        </ng-template>
                                    </p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="detalle_solicitudes_turnos_fechacita" style="min-width:13rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Fecha cita/turno</div>
                                <div>
                                    <p-sortIcon field="detalle_solicitudes_turnos_fechacita"></p-sortIcon>
                                    <p-columnFilter type="date" field="detalle_solicitudes_turnos_fechacita" display="menu" placeholder="Buscar por fecha turno"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="detalle_solicitudes_turnos_horacita2" style="min-width:13rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Hora cita/turno</div>
                                <div>
                                    <p-sortIcon field="detalle_solicitudes_turnos_horacita2"></p-sortIcon>
                                    <p-columnFilter #filterTi type="date" field="detalle_solicitudes_turnos_horacita2" display="menu" placeholder="Buscar por hora turno">
                                        <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                            <p-calendar #calendar2 [ngModel]="value" id="time" (onSelect)="filter(calendar2.value)" [timeOnly]="true" [hourFormat]="'12'" ></p-calendar>
                                        </ng-template>
                                    </p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="detalle_solicitudes_turnos_id" style="min-width:8rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Turno</div>
                                <div>
                                    <p-sortIcon field="detalle_solicitudes_turnos_id"></p-sortIcon>
                                    <p-columnFilter type="numeric" field="detalle_solicitudes_turnos_id" display="menu" placeholder="Buscar por Id turno"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>


                        <th pSortableColumn="detalle_solicitudes_turnos_pedidos_pedidonum" style="min-width:10rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center"># Pedido</div>
                                <div>
                                    <p-sortIcon field="detalle_solicitudes_turnos_pedidos_pedidonum"></p-sortIcon>
                                    <p-columnFilter type="text" field="detalle_solicitudes_turnos_pedidos_pedidonum" display="menu" placeholder="Buscar por # pedido"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="label_cliente" style="min-width:15rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Cliente</div>
                                <div>
                                    <p-sortIcon field="label_cliente"></p-sortIcon>
                                    <p-columnFilter type="text" field="label_cliente" display="menu" placeholder="Buscar por cliente"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="material" style="min-width:15rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Material</div>
                                <div>
                                    <p-sortIcon field="material"></p-sortIcon>
                                    <p-columnFilter type="text" field="material" display="menu" placeholder="Buscar por # pedido"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="detalle_solicitudes_turnos_pedidos_dependencia" style="min-width:11rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Dependencia</div>
                                <div>
                                    <p-sortIcon field="detalle_solicitudes_turnos_pedidos_dependencia"></p-sortIcon>
                                    <p-columnFilter type="text" field="detalle_solicitudes_turnos_pedidos_dependencia" display="menu" placeholder="Buscar por dependencia"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="detalle_solicitudes_turnos_pedidos_localidad" style="min-width:11rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Localidad</div>
                                <div>
                                    <p-sortIcon field="detalle_solicitudes_turnos_pedidos_localidad"></p-sortIcon>
                                    <p-columnFilter type="text" field="detalle_solicitudes_turnos_pedidos_localidad" display="menu" placeholder="Buscar por localidad"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="detalle_solicitudes_turnos_pedidos_bodega" style="min-width:11rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Almacén</div>
                                <div>
                                    <p-sortIcon field="detalle_solicitudes_turnos_pedidos_bodega"></p-sortIcon>
                                    <p-columnFilter type="text" field="detalle_solicitudes_turnos_pedidos_bodega" display="menu" placeholder="Buscar por almacén"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>
						
                        <th pSortableColumn="detalle_solicitudes_turnos_pedidos_cantidad" style="min-width:10rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Cantidad</div>
                                <div>
                                    <p-sortIcon field="detalle_solicitudes_turnos_pedidos_cantidad"></p-sortIcon>
                                    <p-columnFilter type="text" field="detalle_solicitudes_turnos_pedidos_cantidad" display="menu" placeholder="Buscar por cantidad"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="transportadoras_nombre" style="min-width:15rem">
                            <div class="flex  justify-content-between align-items-center">
                                <div class="text-center">Transportadora</div>
                                <div>
                                    <p-sortIcon field="transportadoras_nombre"></p-sortIcon>
                                    <p-columnFilter type="text" field="transportadoras_nombre" display="menu" placeholder="Buscar por transportadora"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="vehiculos_placa" style="min-width:9rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Placa</div>
                                <div>
                                    <p-sortIcon field="vehiculos_placa"></p-sortIcon>
                                    <p-columnFilter type="text" field="vehiculos_placa" display="menu" placeholder="Buscar por placa vehículo"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>
                        <!--
                        <th pSortableColumn="tipovehiculos_tipo" style="min-width:15rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Tipo vehículo</div>
                                <div>
                                    <p-sortIcon field="tipovehiculos_tipo"></p-sortIcon>
                                    <p-columnFilter type="text" field="tipovehiculos_tipo" display="menu" placeholder="Buscar por tipo vehículo"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="vehiculos_capacidad" style="min-width:15rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Capacidad vehículo</div>
                                <div>
                                    <p-sortIcon field="vehiculos_capacidad"></p-sortIcon>
                                    <p-columnFilter type="text" field="vehiculos_capacidad" display="menu" placeholder="Buscar por capacidad vehículo"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>
                        -->
                        <th pSortableColumn="label_conductor" style="min-width:15rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Conductor</div>
                                <div>
                                    <p-sortIcon field="label_conductor"></p-sortIcon>
                                    <p-columnFilter type="text" field="label_conductor" display="menu" placeholder="Buscar por conductor"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="telefonos_conductor" style="min-width:15rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Telefonos conductor</div>
                                <div>
                                    <p-sortIcon field="telefonos_conductor"></p-sortIcon>
                                    <p-columnFilter type="text" field="telefonos_conductor" display="menu" placeholder="Buscar por teléfonos conductor"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>


                        <th pSortableColumn="detalle_solicitudes_turnos_condiciontpt" style="min-width:15rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Condición tpt</div>
                                <div>
                                    <p-sortIcon field="detalle_solicitudes_turnos_condiciontpt"></p-sortIcon>
                                    <p-columnFilter type="text" field="detalle_solicitudes_turnos_condiciontpt" display="menu" placeholder="Buscar por condición tpt"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="lugarentrega" style="min-width:15rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Lugar entrega</div>
                                <div>
                                    <p-sortIcon field="lugarentrega"></p-sortIcon>
                                    <p-columnFilter type="text" field="lugarentrega" display="menu" placeholder="Buscar por lugar entrega"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="remision" style="min-width:15rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center"># Remisión</div>
                                <div>
                                    <p-sortIcon field="remision"></p-sortIcon>
                                    <p-columnFilter type="text" field="remision" display="menu" placeholder="Buscar por remisión"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>



						<th pSortableColumn="solicitudes_turno_id"  style="min-width:7rem">
                            <div class="flex justify-content-between align-items-center">
                                <div class="text-center">Id</div>
                                <div>
                                    <p-sortIcon field="solicitudes_turno_id"></p-sortIcon>
                                    <p-columnFilter type="numeric" field="solicitudes_turno_id" display="menu" placeholder="Buscar por Id Solicitud"></p-columnFilter>
                                </div>
                                
                            </div>
                        </th>

                        <th pSortableColumn="solicitudes_turno_created_at" style="min-width:14rem">
                            <!--<div class="flex align-items-center">-->
                                <div class="flex justify-content-between align-items-center">
                                   
                                   <div class="text-center">Fecha solicitud</div>
                                   <div>
                                        <p-sortIcon field="solicitudes_turno_created_at"></p-sortIcon>
                                        <p-columnFilter type="date" field="solicitudes_turno_created_at" display="menu" placeholder="Buscar por fecha Solicitud">
                                            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                                <p-calendar #calendar [ngModel]="value" (onSelect)="filter(calendar.value)" dateFormat="dd.mm.yy"></p-calendar>
                                            </ng-template>
                                        </p-columnFilter>
                                   </div>
                                   
                                </div>
                                
                                
                            <!--</div>-->
                        </th>

                     

                       <th>

                       </th>

                        

					</tr>
				</ng-template>
				<ng-template pTemplate="body" let-itemData >
					<tr [pSelectableRow]="itemData">
						<td>
                            <p-tableCheckbox [value]="itemData" [id]="'selectRow'+itemData['index']" ></p-tableCheckbox>
                        </td>

                        <td [class]="'text-center bg-'+itemData.bgColor+' text-'+itemData.txtColor">
                            {{ itemData.detalle_solicitudes_turnos_estado }}
                        </td>


                        <td class="text-center">
                            {{ itemData.locacion_label }}
                        </td>

                        <td class="text-center">
                            {{ itemData.detalle_solicitudes_turnos_fechacita | date:'dd/MM/YYYY'  }}
                        </td>
						
                        <td class="text-center">
                            {{ itemData.detalle_solicitudes_turnos_horacita | date:'mediumTime'  }}
                        </td>

                        <td class="text-center">
                            {{ itemData.detalle_solicitudes_turnos_id }}
                        </td>

                        <td class="text-center">
                            {{ itemData.detalle_solicitudes_turnos_pedidos_pedidonum }}
                        </td>

                        <td class="text-center">
                            {{ itemData.label_cliente }}
                        </td>
						
                        <td class="text-center">
                            {{ itemData.material }}
                        </td>

                        <td class="text-center">
                            {{ itemData.detalle_solicitudes_turnos_pedidos_dependencia_label }}
                        </td>

                        <td class="text-center">
                            {{ itemData.detalle_solicitudes_turnos_pedidos_localidad_label }}
                        </td>
                        
                        <td class="text-center">
                            {{ itemData.detalle_solicitudes_turnos_pedidos_bodega }}
                        </td>

                        <td class="text-center">
                            {{ itemData.detalle_solicitudes_turnos_pedidos_cantidad }} TON
                        </td>

                        <td class="text-center">
                            {{ itemData.transportadoras_nombre }}
                        </td>

                        <td class="text-center">
                            {{ itemData.vehiculos_placa }}
                        </td>
                        <!--
                        <td class="text-center">
                            {{ itemData.tipovehiculos_tipo }}
                        </td>

                        <td class="text-center">
                            {{ itemData.vehiculos_capacidad }} TON
                        </td>
                         -->
                        <td class="text-center">
                            {{ itemData.label_conductor }}
                        </td>

                        <td class="text-center">
                            {{ itemData.telefonos_conductor }}
                        </td>

                        <td class="text-center">
                            {{ itemData.detalle_solicitudes_turnos_condiciontpt }}
                        </td>

                        <td class="text-center">
                            {{ itemData.lugarentrega }}
                        </td>

                        <td class="text-center">
                            {{ itemData.remision }}
                        </td>

                        

                        <td class="text-center">
                            {{ itemData.solicitudes_turno_id }}
                        </td>

                        <td class="text-center">
                            {{ itemData.solicitudes_turno_created_at | date:'dd/MM/YYYY' }}
                        </td>

                        <td>

                        </td>

					</tr>
					
				</ng-template>
				<ng-template pTemplate="emptymessage">
					<tr>
						<td [colSpan]="columnsTable"  class="text-center">No se econtraron registros.</td>
					</tr>
				</ng-template>
				<ng-template pTemplate="loadingbody">
					<tr>
						<td [colSpan]="columnsTable" class="text-center">Cargando registros. Por favor espere</td>
					</tr>
				</ng-template>
    		</p-table>
        </div>
    </div>
</div>